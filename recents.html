<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Musico â€” Recents</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <style>
    body{margin:0;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background:#0a0a0b;color:#f1f5f9}
    .container{max-width:1100px;margin:0 auto;padding:24px}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .btn{appearance:none;border:none;background:#1a1a1f;color:#fff;padding:12px 14px;border-radius:12px;cursor:pointer;display:inline-flex;gap:8px;align-items:center}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin-top:12px}
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" onclick="window.location.href='library.html'"><i class="fas fa-arrow-left"></i> Back</button>
        <div style="font-weight:800;font-size:20px">Recents</div>
      </div>
      <div>
        <button id="btnSignIn" class="btn" style="display:none"><i class="fab fa-google"></i> Sign in</button>
        <button id="btnSignOut" class="btn" style="display:none"><i class="fas fa-right-from-bracket"></i> Sign out</button>
      </div>
    </div>
    <div id="grid" class="grid"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_FIREBASE_API_KEY",
      authDomain: "YOUR_FIREBASE_AUTH_DOMAIN",
      projectId: "YOUR_FIREBASE_PROJECT_ID",
      storageBucket: "YOUR_FIREBASE_STORAGE_BUCKET",
      messagingSenderId: "YOUR_FIREBASE_SENDER_ID",
      appId: "YOUR_FIREBASE_APP_ID"
    };
    let app, auth, db, user;
    try{ app = (firebase.apps && firebase.apps.length) ? firebase.app() : firebase.initializeApp(firebaseConfig); auth = firebase.auth(); db = firebase.firestore(); if (auth.setPersistence) auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL).catch(()=>{}); }catch(e){ console.warn('Firebase init failed', e); }
    const $ = id => document.getElementById(id);
    function render(container, items){
      container.innerHTML='';
      items.forEach(v=>{
        const el = document.createElement('div');
        el.style.background = 'linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.04))';
        el.style.border = '1px solid rgba(255,255,255,.1)';
        el.style.borderRadius = '16px';
        el.innerHTML = `<img src="${v.thumbnail}" style="width:100%;height:160px;object-fit:cover;border-top-left-radius:16px;border-top-right-radius:16px" /><div style="padding:12px"><div style="font-weight:700">${v.title}</div><div style="color:#9ca3af">${v.channel}</div></div>`;
        el.onclick = ()=> window.location.href='index.html';
        container.appendChild(el);
      });
    }
    function load(){
      if(!auth){ $('btnSignIn').style.display=''; return; }
      auth.onAuthStateChanged(async u=>{
        user = u; $('btnSignIn').style.display = user ? 'none' : ''; $('btnSignOut').style.display = user ? '' : 'none';
        if(!user){ $('grid').innerHTML=''; return; }
        const snap = await db.collection('users').doc(user.uid).collection('recents').orderBy('playedAt','desc').get();
        render($('grid'), snap.docs.map(d=>d.data()));
      });
    }
    $('btnSignIn').onclick = ()=> window.location.href='auth.html';
    $('btnSignOut').onclick = ()=> auth && auth.signOut().then(()=>{}).catch(()=>{});
    load();
  </script>
</body>
</html>


