<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Musico â€” Sign In</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <style>
    body{margin:0;font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;background:#0a0a0b;color:#f1f5f9;display:grid;place-items:center;min-height:100vh}
    .card{background:linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.04));border:1px solid rgba(255,255,255,.1);border-radius:16px;padding:24px;box-shadow:0 20px 50px rgba(0,0,0,.4);width:min(420px, 92vw)}
    .title{font-size:22px;font-weight:800;margin-bottom:8px}
    .muted{color:#9ca3af}
    .btn{appearance:none;border:none;background:#1a1a1f;color:#fff;padding:14px 16px;border-radius:12px;display:flex;gap:10px;align-items:center;justify-content:center;cursor:pointer;transition:.2s;font-weight:700;width:100%;margin-top:12px}
    .btn.primary{background:linear-gradient(135deg, #6366f1, #06b6d4)}
    .btn:hover{transform:translateY(-2px)}
    input{width:100%;background:rgba(255,255,255,.06);border:2px solid rgba(255,255,255,.1);color:#fff;padding:12px 14px;border-radius:12px;outline:none}
    input+input{margin-top:8px}
    .row{display:flex;gap:8px}
  </style>
</head>
<body>
  <div class="card">
    <div class="title">Sign in to Musico</div>
    <div class="muted">Sync likes, recents, and playlists across devices.</div>
    <div id="state" class="muted" style="margin:8px 0 0"></div>
    <button id="btnGoogle" class="btn primary"><i class="fab fa-google"></i> Continue with Google</button>
    <div style="height:8px"></div>
    <div class="row">
      <input id="email" type="email" placeholder="Email" />
      <input id="password" type="password" placeholder="Password" />
    </div>
    <button id="btnEmail" class="btn"><i class="fas fa-envelope"></i> Continue with Email</button>
    <div id="msg" class="muted" style="margin-top:12px"></div>
    <button id="btnBack" class="btn" style="margin-top:16px"><i class="fas fa-arrow-left"></i> Back to player</button>
    <button id="btnContinue" class="btn primary" style="display:none;margin-top:8px"><i class="fas fa-check"></i> Continue</button>
  </div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC7x_cV1CWB1rSSFUOGN9hpmJ3UAu3f_54",
      authDomain: "chitchatrr-acf29.firebaseapp.com",
      projectId: "chitchatrr-acf29",
      storageBucket: "chitchatrr-acf29.firebasestorage.app",
      messagingSenderId: "555502454888",
      appId: "1:555502454888:web:0fbd6adf18d573707653dd"
    };
    let app, auth, db;
    try{
      app = (firebase.apps && firebase.apps.length) ? firebase.app() : firebase.initializeApp(firebaseConfig);
      auth = firebase.auth();
      db = firebase.firestore();
      if (auth && auth.setPersistence) {
        auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL).catch(()=>{});
      }
    }catch(e){ console.warn('Firebase init failed', e); }

    const $ = id => document.getElementById(id);
    const msg = $('msg');
    const stateEl = $('state');
    $('btnBack').onclick = ()=> window.location.href = 'index.html';
    $('btnGoogle').onclick = async ()=>{
      try{
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.setCustomParameters({prompt:'select_account'});
        await auth.signInWithPopup(provider);
        try{ localStorage.setItem('MUSICO_LOGIN_SUCCESS','1'); }catch(_){ }
        // stay on page; let user decide to continue
        updateSignedInUI(auth.currentUser);
      }catch(e){ msg.textContent = e.message || 'Sign-in failed'; }
    };
    $('btnEmail').onclick = async ()=>{
      const email = $('email').value.trim();
      const password = $('password').value;
      if(!email || !password){ msg.textContent = 'Enter email and password'; return; }
      try{
        try{ await auth.signInWithEmailAndPassword(email, password); }
        catch(e){ await auth.createUserWithEmailAndPassword(email, password); }
        try{ localStorage.setItem('MUSICO_LOGIN_SUCCESS','1'); }catch(_){ }
        updateSignedInUI(auth.currentUser);
      }catch(e){ msg.textContent = e.message || 'Sign-in failed'; }
    };
    $('btnContinue').onclick = ()=> window.location.href = 'index.html';

    function updateSignedInUI(user){
      if (!user) {
        stateEl.textContent = 'Not signed in';
        $('btnContinue').style.display = 'none';
        $('btnGoogle').disabled = false;
        $('btnEmail').disabled = false;
        return;
      }
      const name = user.displayName || user.email || 'User';
      stateEl.textContent = `Signed in as ${name}`;
      $('btnContinue').style.display = '';
      $('btnGoogle').disabled = true;
      $('btnEmail').disabled = true;
    }
    if (auth) {
      auth.onAuthStateChanged(u=> updateSignedInUI(u));
    }
  </script>
</body>
</html>


